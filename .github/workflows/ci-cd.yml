name: CI/CD Debug

on:
  workflow_dispatch:          # allows manual runs from Actions UI
  push:
    branches: [ main ]
    paths:
      - 'CICD-Pipeline-with-GitHub-Actions/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'CICD-Pipeline-with-GitHub-Actions/**'

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo (full)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show environment
        run: |
          echo "GITHUB_REF=$GITHUB_REF"
          echo "GITHUB_SHA=$GITHUB_SHA"
          echo "GITHUB_EVENT_NAME=$GITHUB_EVENT_NAME"
          echo "GITHUB_WORKSPACE=$GITHUB_WORKSPACE"

      - name: List top-level files
        run: |
          ls -la
          echo "--- .github ---"
          ls -la .github || true
          echo "--- .github/workflows ---"
          ls -la .github/workflows || true
          echo "--- project folder ---"
          ls -la CICD-Pipeline-with-GitHub-Actions || true

      - name: Show last commits affecting project folder
        run: |
          git --no-pager log -n 5 --pretty=oneline -- . || true
          git --no-pager log -n 5 --pretty=oneline -- CICD-Pipeline-with-GitHub-Actions || true

      - name: Show changed files for this push (if available)
        run: |
          echo "Event JSON location: $GITHUB_EVENT_PATH"
          jq -r '.commits[]?.added + " " + .commits[]?.modified + " " + .commits[]?.removed' $GITHUB_EVENT_PATH || true
